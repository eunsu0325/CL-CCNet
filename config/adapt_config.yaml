# config/adapt_config.yaml - ë°°ì¹˜ êµ¬ì„± ì œì–´ ì™„ì „ ë²„ì „

# =================================================================
# DESIGN PHILOSOPHY (Headless ì˜µì…˜ + ë°°ì¹˜ êµ¬ì„± ì œì–´)
# =================================================================
Design_Documentation:
  philosophy: "Intelligent Replay Buffer for Continual Palmprint Recognition"
  core_innovation: "Controlled batch composition with precise ratios"
  main_contribution: "Memory-efficient continual learning with optimal positive/hard ratios"
  loss_strategy: "Basic SupCon for stable continual learning"
  buffer_strategy: "Faiss-optimized diversity + controlled sampling"
  scientific_basis: "Proven SupCon + Novel controlled batch composition"
  headless_capability: "Optional head removal for open-set verification"

# =================================================================
# DATASET CONFIGURATION
# =================================================================
Dataset:
  type: "palmprint"
  height: 128
  width: 128
  use_angle_normalization: false
  dataset_path: "./data/test_tongji.txt"

# =================================================================
# MODEL CONFIGURATION (CCNet with Headless Option)
# =================================================================
PalmRecognizer:
  architecture: "CCNet"
  num_classes: 600
  com_weight: 0.8
  feature_dimension: 2048
  learning_rate: 0.001
  batch_size: 1024  # ğŸ”¥ ì‚¬ì „í›ˆë ¨ìš© ë°°ì¹˜ì‚¬ì´ì¦ˆ (ì—°ì†í•™ìŠµê³¼ ë³„ê°œ)
  load_weights_folder: "./results/checkpoint/net_params_best.pth"
  compression_dim: Optional[int] = 128
  
  # ğŸ”¥ Headless Configuration
  headless_mode: false
  verification_method: "classification"
  metric_type: "cosine"
  similarity_threshold: 0.5

# =================================================================
# CONTINUAL LEARNER CONFIGURATION (ğŸ”¥ ë°°ì¹˜ êµ¬ì„± ì œì–´ ì¶”ê°€)
# =================================================================
ContinualLearner:
  adaptation: true
  adaptation_epochs: 2
  sync_frequency: 10
  replay_weight: 1.0
  new_data_weight: 1.0
  intermediate_save_frequency: 50
  learning_rate: 0.001
  
  # ğŸ”¥ ì—°ì†í•™ìŠµ ì „ìš© ë°°ì¹˜ ì‚¬ì´ì¦ˆ (PalmRecognizer.batch_sizeì™€ ë³„ê°œ)
  continual_batch_size: 10  # â† ì´ê²Œ ì‹¤ì œ ì—°ì†í•™ìŠµ ë°°ì¹˜ ì‚¬ì´ì¦ˆ!
  
  # ğŸ”¥ NEW: ë°°ì¹˜ êµ¬ì„± ë¹„ìœ¨ ì œì–´
  target_positive_ratio: 0.3      # 30% positive pairs (3ê°œ ìƒ˜í”Œ in batch of 10)
  hard_mining_ratio: 0.3          # 30% hard samples (3ê°œ in batch of 10)
  enable_hard_mining: true        # Hard mining í™œì„±í™”
  
  # ê¸°ì¡´ Hard Mining ì„¤ì • (í˜¸í™˜ì„±)
  hard_mining_ratio_legacy: 0.3

# =================================================================
# REPLAY BUFFER CONFIGURATION (ğŸ”¥ ìƒ˜í”Œë§ ì „ëµ ì œì–´ ì¶”ê°€)
# =================================================================
ReplayBuffer:
  maximize_diversity: true
  max_buffer_size: 50
  similarity_threshold: 0.85
  storage_path: "./results/replay_buffer/"
  feature_extraction_for_diversity: true
  enable_smart_sampling: true
  diversity_update_frequency: 10
  model_save_path: "./results/models/"
  
  # ğŸ”¥ NEW: ì œì–´ëœ ìƒ˜í”Œë§ ì „ëµ
  sampling_strategy: "controlled"     # "controlled", "balanced", "original"
  force_positive_pairs: true          # í•­ìƒ positive pairs ë³´ì¥
  min_positive_pairs: 1               # ìµœì†Œ positive pair ìˆ˜
  max_positive_ratio: 0.5             # ìµœëŒ€ positive pair ë¹„ìœ¨ ì œí•œ

# =================================================================
# DATA AUGMENTATION
# =================================================================
DataAugmentation:
  enable_augmentation: true
  augmentation_probability: 0.4
  
  enable_geometric: true
  geometric_probability: 0.3
  max_rotation_degrees: 3
  max_translation_ratio: 0.05
  
  enable_resolution_adaptation: true
  resolution_probability: 0.3
  intermediate_resolutions:
    - [64, 64]
    - [96, 96]
    - [160, 160]
  resize_methods: ["nearest", "bilinear", "bicubic", "lanczos"]
  
  enable_noise: true
  noise_probability: 0.3
  noise_std_range: [0.01, 0.03]

# =================================================================
# LOSS CONFIGURATION
# =================================================================
Loss:
  temp: 0.07
  type: "SupConLoss"
  weight1: 0.8  # ArcFace (Stage 1 ì°¸ê³ ìš©)
  weight2: 0.2  # SupCon

# =================================================================
# MODEL SAVING CONFIGURATION
# =================================================================
ModelSaving:
  final_save_path: "/content/drive/MyDrive/CoCoNut_STAR"
  intermediate_save_frequency: 100
  enable_intermediate_save: true
  include_timestamp: true
  auto_generate_readme: true